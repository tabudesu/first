<!DOCTYPE html>

<html lang="ja">
<head>
    <meta charset="utf-8">
    <title>バーコードリーダーを使ってみよう！</title>
</head>
<body>
    <nav>
        <ul>
            <li><a href="index.html">入力画面</a></li>
            <li><a href="table.html">照会画面</a></li>
        </ul>
    </nav>


    <h1>入力画面</h1>
    <p>バーコードリーダーを使用してバーコードを読み取ってください。</p>
    <textarea id="input" maxlength="13"></textarea>

    <button type="button" onclick="search()">
        確定
    </button>

    <button type="button" onclick="allclear()">
        クリア
    </button>
    <p id="janError"></p>
    <p>検索結果</p>
    <p>商品名</p><span id="itemName"></span>

    <p>購入価格</p>
    <textarea id="itemPrice"></textarea>
    <button type="button" onclick="search()">
        登録
    </button>

    <script>

        function search() {
            //JAN取得
            var serarhkeyword = document.getElementById("input").innerText;

            if (serarhkeyword.length == 13) {
                document.getElementById("janError").textContent = null;
                document.getElementById("itemPrice").textContent = null;

                var request = new XMLHttpRequest();
                //アプリケーションID（楽天）
                var applicationId = "1049198666783003336";
                //リクエスト作成
                var requestStr = "https://app.rakuten.co.jp/services/api/IchibaItem/" +
                    "Search/20170706?format=json&keyword=" +
                    serarhkeyword + "&applicationId=" + applicationId;

                request.open('GET', requestStr, true);
                request.responseType = 'json';

                request.onload = function () {
                    var data = this.response;
                    const from_json = JSON.parse(data);

                    // 確認用
                    console.log(from_json);

                    if (from_json.Items[0] != 0) {
                        document.getElementById("itemName").textContent = from_json.Items[1].Item.itemName;
                    }
                    else {
                        document.getElementById("itemName").textContent = "該当商品がありません"
                    }

                };

                request.send();
            }
            else {
                document.getElementById("itemName").textContent = null;
                document.getElementById("itemPrice").textContent = null;
                document.getElementById("janError").textContent = "JANコードの桁数が間違っています"
            }

        }

        function allclear() {
            document.getElementById("input").textContent = null;
            document.getElementById("itemName").textContent = null;
            document.getElementById("itemPrice").textContent = null;
            document.getElementById("janError").textContent = null;
        }

    </script>
</body>
</html>
